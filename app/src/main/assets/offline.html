<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>Offline</title>
  <style>
    :root{
      --bg:#0b1220; --fg:#e5f0ff; --muted:#98a2b3; --accent:#0ea5e9;
      --ring:#60a5fa33; --card:#0f172a; --shadow:0 10px 30px rgba(0,0,0,.25);
      --btn:#0ea5e9; --btn-ok:#10b981; --btn-fg:#fff;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f8fafc; --fg:#0f172a; --muted:#64748b; --accent:#0284c7;
        --ring:#0284c71f; --card:#ffffff; --shadow:0 10px 30px rgba(2,8,23,.08);
        --btn:#0284c7; --btn-ok:#059669; --btn-fg:#fff;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 800px at 50% -100px, var(--ring), transparent 60%), var(--bg);
      color:var(--fg); font:500 16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica Neue,Arial,Noto Sans,Apple Color Emoji,Segoe UI Emoji;
      display:grid; place-items:center;
    }
    .card{
      width:min(560px,92vw); background:var(--card); border-radius:20px; box-shadow:var(--shadow);
      padding:28px 28px 32px; text-align:center; border:1px solid rgba(255,255,255,.06);
    }
    .art{width:140px;height:140px;margin:8px auto 18px;filter:drop-shadow(0 6px 16px rgba(0,0,0,.25))}
    .pulse{animation:pulse 2.4s ease-in-out infinite; transform-origin:50% 50%}
    @keyframes pulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.04);opacity:.96}100%{transform:scale(1);opacity:1}}
    .wave{animation:wave 2.4s ease-in-out infinite}
    @keyframes wave{0%{opacity:.35;transform:translateY(0)}50%{opacity:.12;transform:translateY(4px)}100%{opacity:.35;transform:translateY(0)}}
    h1{font-size:clamp(20px,3.8vw,28px);margin:0 0 6px}
    p{margin:8px 0 0;color:var(--muted)}
    .actions{margin-top:18px;display:flex;justify-content:center}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:.5rem;
      font-weight:800;padding:12px 16px;border-radius:12px;border:none;cursor:pointer;
      background:var(--btn);color:var(--btn-fg);box-shadow:var(--shadow);
      transition:transform .08s ease,opacity .2s ease,background .2s ease,box-shadow .2s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{opacity:.6;pointer-events:none}
    .btn-ok{background:var(--btn-ok)}
    .shake{animation:shake .3s ease}
    @keyframes shake{
      10%,90%{transform:translateX(-1px)}
      20%,80%{transform:translateX(2px)}
      30%,50%,70%{transform:translateX(-4px)}
      40%,60%{transform:translateX(4px)}
    }
    .hint{margin-top:10px;font-size:13px;color:var(--muted);opacity:.95}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <main class="card" role="main" aria-live="polite">
    <div class="art" aria-hidden="true">
      <svg viewBox="0 0 160 160" width="140" height="140">
        <circle class="wave" cx="80" cy="80" r="70" fill="none" stroke="url(#g1)" stroke-width="2"/>
        <defs>
          <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="var(--accent)" stop-opacity=".35"/>
            <stop offset="100%" stop-color="var(--accent)" stop-opacity=".05"/>
          </linearGradient>
        </defs>
        <rect x="44" y="60" rx="10" ry="10" width="72" height="48" fill="var(--bg)" stroke="var(--accent)" stroke-width="2.5"/>
        <rect x="54" y="50" width="10" height="16" rx="3" fill="var(--accent)" opacity=".9"/>
        <rect x="96" y="50" width="10" height="16" rx="3" fill="var(--accent)" opacity=".9"/>
        <path d="M116 84 C136 84, 144 96, 144 110 S132 136, 110 136" fill="none" stroke="var(--accent)" stroke-width="3" stroke-dasharray="6 6"/>
        <g class="pulse" transform="translate(64,82)">
          <path d="M0 0 L32 32 M32 0 L0 32" stroke="var(--accent)" stroke-width="3" stroke-linecap="round"/>
        </g>
      </svg>
    </div>

    <h1>Sem conex√£o</h1>
    <p>Toque em ‚ÄúReconectar‚Äù para tentar voltar.</p>

    <div class="actions">
      <button id="retryBtn" class="btn" type="button" aria-describedby="hint">üîÑ Reconectar</button>
    </div>
    <p id="hint" class="hint">Se houver internet, retorna automaticamente √† p√°gina anterior.</p>

    <span id="live" class="sr-only" aria-live="polite" aria-atomic="true"></span>
  </main>

  <script>
    (function(){
      'use strict';

      const ORIGIN_PING = '/';     // voc√™ pode trocar por um arquivo est√°tico do seu dom√≠nio
      const live = document.getElementById('live');
      const btn  = document.getElementById('retryBtn');

      function speak(msg){ try{ live.textContent = msg; }catch(e){} }

      // Probe 1: navigator.onLine (r√°pido, mas nem sempre confi√°vel)
      function isOnlineHint(){ return typeof navigator.onLine === 'boolean' ? navigator.onLine : false; }

      // Probe 2: fetch HEAD (no-cors) ‚Äî se n√£o der erro de rede, consideramos OK
      async function fetchProbe(url){
        const ctrl = new AbortController();
        const t = setTimeout(()=>ctrl.abort(), 2500);
        try{
          await fetch(url, { method:'HEAD', mode:'no-cors', cache:'no-store', credentials:'omit', signal:ctrl.signal });
          clearTimeout(t);
          return true; // sem erro de rede
        }catch(e){
          clearTimeout(t);
          return false;
        }
      }

      // Probe 3: ping por <img> (ignora CORS e muitos proxies)
      function imgProbe(url, timeoutMs=3000){
        return new Promise(resolve=>{
          const img = new Image();
          let done=false;
          const finish = ok => { if(done) return; done=true; cleanup(); resolve(ok); };
          const timer = setTimeout(()=>finish(false), timeoutMs);
          function cleanup(){ clearTimeout(timer); img.onload=null; img.onerror=null; }
          img.onload = () => finish(true);
          img.onerror = () => finish(false);
          img.src = url + (url.includes('?') ? '&' : '?') + 'ts=' + Date.now();
        });
      }

      async function checkConnectivity(){
        // Estrat√©gia: qualquer probe positivo j√° √© suficiente
        if (isOnlineHint()) return true;
        const [a, b] = await Promise.allSettled([ fetchProbe(ORIGIN_PING), imgProbe(ORIGIN_PING) ]);
        const ok = (a.status==='fulfilled' && a.value===true) || (b.status==='fulfilled' && b.value===true);
        return ok;
      }

      async function onRetryClick(){
        // Protege contra m√∫ltiplos cliques
        btn.disabled = true;
        btn.classList.remove('shake');
        btn.textContent = '‚è≥ Verificando...';
        speak('Verificando conex√£o');

        const ok = await checkConnectivity();

        if (ok){
          btn.textContent = '‚úÖ Conectado! Voltando...';
          speak('Conex√£o detectada, retornando');
          // pequeno delay para feedback visual
          setTimeout(()=>{ try{ history.back(); }catch(e){} }, 150);
        }else{
          // continua na mesma p√°gina
          btn.disabled = false;
          btn.textContent = 'üîÑ Reconectar';
          btn.classList.add('shake');
          setTimeout(()=>btn.classList.remove('shake'), 350);
          speak('Sem conex√£o, tente novamente');
          try{ if(navigator.vibrate) navigator.vibrate(80); }catch(e){}
        }
      }

      btn.addEventListener('click', onRetryClick);

      // Tamb√©m permite tentar com Enter/Espa√ßo quando focado
      btn.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          onRetryClick();
        }
      });
    })();
  </script>
</body>
</html>
